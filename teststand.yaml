apiVersion: v1
items:
- apiVersion: postgresql.cnpg.io/v1
  kind: Cluster
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","metadata":{"annotations":{},"name":"usdf-butler-teststand","namespace":"teststand-prod"},"spec":{"backup":{"barmanObjectStore":{"destinationPath":"s3://rubin-usdf-butler-teststand","endpointURL":"https://s3dfrgw.slac.stanford.edu","s3Credentials":{"accessKeyId":{"key":"ACCESS_KEY_ID","name":"s3-creds"},"secretAccessKey":{"key":"ACCESS_SECRET_KEY","name":"s3-creds"}}},"retentionPolicy":"15d"},"bootstrap":{"initdb":{"database":"lsstdb1","owner":"rubin","secret":{"name":"usdf-butler-teststand-creds"}}},"imageName":"ghcr.io/lsst-sqre/cnpg-postgres-images:16.3","inheritedMetadata":{"annotations":{"prometheus.io/scrape":"true"}},"instances":2,"monitoring":{"enablePodMonitor":true},"nodeMaintenanceWindow":{"inProgress":false,"reusePVC":true},"postgresql":{"parameters":{"dynamic_shared_memory_type":"posix","log_destination":"csvlog","log_directory":"/controller/log","log_disconnections":"off","log_duration":"off","log_filename":"postgres","log_min_duration_statement":"250ms","log_rotation_age":"0","log_rotation_size":"0","log_statement":"none","log_temp_files":"1","log_truncate_on_rotation":"false","logging_collector":"on","maintenance_work_mem":"12GB","max_connections":"2000","max_parallel_workers":"32","max_replication_slots":"32","max_slot_wal_keep_size":"100GB","max_wal_size":"256GB","max_worker_processes":"32","min_wal_size":"4GB","pg_stat_statements.track":"none","random_page_cost":"1.1","shared_buffers":"8GB","wal_compression":"off","wal_keep_size":"512MB","wal_receiver_timeout":"5s","wal_sender_timeout":"5s","work_mem":"320MB"}},"primaryUpdateStrategy":"unsupervised","resources":{"limits":{"cpu":8,"memory":"32Gi"},"requests":{"cpu":4,"memory":"16Gi"}},"storage":{"size":"1000Gi","storageClass":"wekafs--sdf-k8s01"}}}
    creationTimestamp: "2024-08-26T07:54:17Z"
    generation: 4
    name: usdf-butler-teststand
    namespace: teststand-prod
    resourceVersion: "171473449"
    uid: 41690a69-3640-4fc6-ad80-d90344637d95
  spec:
    affinity:
      podAntiAffinityType: preferred
    backup:
      barmanObjectStore:
        destinationPath: s3://rubin-usdf-butler-teststand
        endpointURL: https://s3dfrgw.slac.stanford.edu
        s3Credentials:
          accessKeyId:
            key: ACCESS_KEY_ID
            name: s3-creds
          secretAccessKey:
            key: ACCESS_SECRET_KEY
            name: s3-creds
      retentionPolicy: 15d
      target: prefer-standby
    bootstrap:
      initdb:
        database: lsstdb1
        encoding: UTF8
        localeCType: C
        localeCollate: C
        owner: rubin
        secret:
          name: usdf-butler-teststand-creds
    enablePDB: true
    enableSuperuserAccess: false
    failoverDelay: 0
    imageName: ghcr.io/lsst-sqre/cnpg-postgres-images:16.3
    inheritedMetadata:
      annotations:
        prometheus.io/scrape: "true"
    instances: 2
    logLevel: info
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      customQueriesConfigMap:
      - key: queries
        name: cnpg-default-monitoring
      disableDefaultQueries: false
      enablePodMonitor: true
    nodeMaintenanceWindow:
      inProgress: false
      reusePVC: true
    postgresGID: 26
    postgresUID: 26
    postgresql:
      parameters:
        archive_mode: "on"
        archive_timeout: 5min
        dynamic_shared_memory_type: posix
        full_page_writes: "on"
        log_destination: csvlog
        log_directory: /controller/log
        log_disconnections: "off"
        log_duration: "off"
        log_filename: postgres
        log_min_duration_statement: 250ms
        log_rotation_age: "0"
        log_rotation_size: "0"
        log_statement: none
        log_temp_files: "1"
        log_truncate_on_rotation: "false"
        logging_collector: "on"
        maintenance_work_mem: 12GB
        max_connections: "2000"
        max_parallel_workers: "32"
        max_replication_slots: "32"
        max_slot_wal_keep_size: 100GB
        max_wal_size: 256GB
        max_worker_processes: "32"
        min_wal_size: 4GB
        pg_stat_statements.track: none
        random_page_cost: "1.1"
        shared_buffers: 8GB
        shared_memory_type: mmap
        shared_preload_libraries: ""
        ssl_max_protocol_version: TLSv1.3
        ssl_min_protocol_version: TLSv1.3
        wal_compression: "off"
        wal_keep_size: 512MB
        wal_level: logical
        wal_log_hints: "on"
        wal_receiver_timeout: 5s
        wal_sender_timeout: 5s
        work_mem: 320MB
      syncReplicaElectionConstraint:
        enabled: false
    primaryUpdateMethod: restart
    primaryUpdateStrategy: unsupervised
    replicationSlots:
      highAvailability:
        enabled: true
        slotPrefix: _cnpg_
      synchronizeReplicas:
        enabled: true
      updateInterval: 30
    resources:
      limits:
        cpu: "8"
        memory: 32Gi
      requests:
        cpu: "4"
        memory: 16Gi
    smartShutdownTimeout: 180
    startDelay: 3600
    stopDelay: 1800
    storage:
      resizeInUseVolumes: true
      size: 1000Gi
      storageClass: wekafs--sdf-k8s01
    switchoverDelay: 3600
  status:
    availableArchitectures:
    - goArch: amd64
      hash: 0a8f22a9c14805f67b92f6994d6487da7570929108443d1a70a66b8d47a51b2f
    - goArch: arm64
      hash: c8318d0576271cba8bdb120a6500f273038035a9bf97e36c9a367ea0ae3590c0
    certificates:
      clientCASecret: usdf-butler-teststand-ca
      expirations:
        usdf-butler-teststand-ca: 2025-07-31 07:38:13 +0000 UTC
        usdf-butler-teststand-replication: 2025-07-31 07:38:13 +0000 UTC
        usdf-butler-teststand-server: 2025-08-23 20:52:06 +0000 UTC
      replicationTLSSecret: usdf-butler-teststand-replication
      serverAltDNSNames:
      - usdf-butler-teststand-rw
      - usdf-butler-teststand-rw.teststand-prod
      - usdf-butler-teststand-rw.teststand-prod.svc
      - usdf-butler-teststand-rw.teststand-prod.svc.cluster.local
      - usdf-butler-teststand-r
      - usdf-butler-teststand-r.teststand-prod
      - usdf-butler-teststand-r.teststand-prod.svc
      - usdf-butler-teststand-r.teststand-prod.svc.cluster.local
      - usdf-butler-teststand-ro
      - usdf-butler-teststand-ro.teststand-prod
      - usdf-butler-teststand-ro.teststand-prod.svc
      - usdf-butler-teststand-ro.teststand-prod.svc.cluster.local
      serverCASecret: usdf-butler-teststand-ca
      serverTLSSecret: usdf-butler-teststand-server
    cloudNativePGCommitHash: c56e00d4
    cloudNativePGOperatorHash: 0a8f22a9c14805f67b92f6994d6487da7570929108443d1a70a66b8d47a51b2f
    conditions:
    - lastTransitionTime: "2025-06-02T20:46:42Z"
      message: Cluster is Ready
      reason: ClusterIsReady
      status: "True"
      type: Ready
    - lastTransitionTime: "2024-11-03T17:36:05Z"
      message: 'unexpected failure invoking barman-cloud-wal-archive: exit status
        4'
      reason: ContinuousArchivingFailing
      status: "False"
      type: ContinuousArchiving
    - lastTransitionTime: "2024-10-10T23:15:38Z"
      message: "cmd: [/controller/manager backup usdf-butler-teststand-backup-20250217000000]\nerror:
        unable to upgrade connection: container not found (\"postgres\")\nstdErr: "
      reason: LastBackupFailed
      status: "False"
      type: LastBackupSucceeded
    configMapResourceVersion:
      metrics:
        cnpg-default-monitoring: "105244222"
    currentPrimary: usdf-butler-teststand-3
    currentPrimaryTimestamp: "2025-05-26T21:37:00.118227Z"
    healthyPVC:
    - usdf-butler-teststand-3
    - usdf-butler-teststand-4
    image: ghcr.io/lsst-sqre/cnpg-postgres-images:16.3
    instanceNames:
    - usdf-butler-teststand-3
    - usdf-butler-teststand-4
    instances: 2
    instancesReportedState:
      usdf-butler-teststand-3:
        isPrimary: true
        timeLineID: 17
      usdf-butler-teststand-4:
        isPrimary: false
        timeLineID: 17
    instancesStatus:
      healthy:
      - usdf-butler-teststand-3
      - usdf-butler-teststand-4
    lastFailedBackup: "2024-11-03T00:00:01Z"
    latestGeneratedNode: 4
    managedRolesStatus: {}
    phase: Cluster in healthy state
    poolerIntegrations:
      pgBouncerIntegration:
        secrets:
        - usdf-butler-teststand-pooler
    pvcCount: 2
    readService: usdf-butler-teststand-r
    readyInstances: 2
    secretsResourceVersion:
      applicationSecretVersion: "109998543"
      clientCaSecretVersion: "160809629"
      replicationSecretVersion: "160809630"
      serverCaSecretVersion: "160809629"
      serverSecretVersion: "169343355"
    switchReplicaClusterStatus: {}
    targetPrimary: usdf-butler-teststand-3
    targetPrimaryTimestamp: "2025-05-26T21:36:57.349682Z"
    timelineID: 17
    topology:
      instances:
        usdf-butler-teststand-3: {}
        usdf-butler-teststand-4: {}
      nodesUsed: 2
      successfullyExtracted: true
    writeService: usdf-butler-teststand-rw
kind: List
metadata:
  resourceVersion: ""
